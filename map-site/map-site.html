<!DOCTYPE html>
<html>
  <head>
    
    <!-- import leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""/>

    <!-- Make sure you put this AFTER Leaflet's CSS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""></script>

    <img rel="import", href="icon.jpg">

    <title>Social Media Combat Detection Map</title>

  </head>
  <body style="padding:2%">
    <h1><img src="/icon" alt="logo" style="height: 30px;"/>CombatMessagesUA</h1>
    <p style="width:85%">This map aggregates reports of combat and military operations from Ukrainian telegram channels. Posts are sourced from @AmplifyUkraine, and filtered by an AI model. This map is updated on a delay and may not be accurate.</p>
    <div id="map" style="width: 98%; height: 75vh;"></div>
    <script type="text/javascript">

        // initialize the map
        
        var map = L.map('map').setView([49.5, 35], 6); // change lat, long, zoom in setView

        L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        }).addTo(map);

        // get messages from database
        async function getDocuments() {
          const response = await fetch('/getDocuments');
          const documents = await response.json();
          documents.forEach(doc => {
            // map each message
            var marker = L.marker(doc.location).addTo(map);
            var popupText = doc.message;
            marker.bindPopup(popupText).openPopup();
          });
        }

        getDocuments();


    </script>
  </body>
</html>