<!DOCTYPE html>
<html>
  <head>

    <!-- import leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""/>

    <!-- Make sure you put this AFTER Leaflet's CSS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""></script>

    <title>CombatMessagesUA</title>

  </head>
  <body style="background-color:#B0B0B0; padding:.5%" >
    <div id="header" style="width:98%">
      <img src="/cmua" alt="cmua-logo" id="cmua-logo" style="height: 8vh;"/>
      <div style="background-color: #d9d9d9;border-radius: 15px;"><p style="padding:1.5%;color:#5D5D5D; font-size: 2vh; text-align: justify; font-family: Arial;">This map aggregates reports of combat and military operations from Ukrainian Telegram channels scraped from <a href="https://amplifyukraine.eu/">@AmplifyUkraine</a>. This map is updated on a delay and may not be accurate. CombatMessagesUA is a project of  <a href="https://e4ua.org/">Engineers for Ukraine</a>.</p></div>
    </div>
    <div id="map" style="height: 75vh; border-radius: 15px;"></div>
    <script type="text/javascript">

        // initialize the map
        
        var map = L.map('map').setView([48, 35], 6); // change lat, long, zoom in setView

        L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        }).addTo(map);

        // get messages from database
        async function getDocuments() {
          const response = await fetch('/getDocuments');
          const documents = await response.json();
          documents.forEach(doc => {
            // map each message
            var marker = L.marker(doc.location).addTo(map);
            var contents = doc.datetime.replace('T', ' ').replace('Z', ' ').concat('\n\n', doc.message)
            marker.bindPopup(contents, {
              maxHeight:150,
            }).openPopup();
          });
        }

        getDocuments();


    </script>
  </body>
</html>